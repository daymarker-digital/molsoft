{%- comment -%}
  /**
   *  Featured Collection
   *
   *  Dynamic Shopify section that displays a collection of products from
   *  from a featured collection.
   *
   *  @author Brenden Mersey
   *
   *  @package Shopify
   *  @subpackage molsoft
   */
{%- endcomment -%}

{%- liquid

  capture section_show
    render "section-persona-logic", section_settings: section.settings
  endcapture

  assign section_name = "shop-collection"

  assign has_carousel_items = false
  assign heading = section.settings.heading | default: ""
  assign layout = section.settings.layout
  assign message = section.settings.message | default: ""
  assign selected_collection = section.settings.collection | default: false
  assign selected_collection_cta_title = section.settings.collection_cta_title | default: "Shop all"
  assign selected_collection_product_limit = section.settings.collection_product_limit
  assign selected_collection_products = selected_collection.products | default: false
  assign selected_collection_url = selected_collection.url | default: ""

  if selected_collection_products and selected_collection_products.size > 0
    assign has_carousel_items = true
  endif

-%}

{%- if section_show == "true" or request.design_mode -%}

  {%- style -%}
    {%- render "section-styles", section_id: section.id, section_settings: section.settings -%}
  {%- endstyle -%}

  {%- render "section-persona-info", section_settings: section.settings -%}

  <div class="container container--{{ layout }}">
    <div class="container__row">

      <div class="embla{% if has_carousel_items %} js--embla{% endif %}" data-carousel-type="{{ section_name }}">
        <div class="embla__main">

          <div class="embla__header">

            {%- if heading != blank or message != blank -%}
              <div class="embla__content">
                {%- if heading != blank -%}
                  <h2 class="embla__heading type-heading--2">{{ heading }}</h2>
                {%- endif -%}
                {% if message != blank %}
                  <div class="embla__message type-rte">{{ message }}</div>
                {% endif %}
              </div>
            {%- endif -%}

            <div class="embla__nav-container desktop-only--flex">
              {%- render "content-link", link_classes: "embla__cta", link_title: selected_collection_cta_title, link_url: selected_collection_url, link_style: "text" -%}
              <button class="embla__nav embla__nav--prev button button--carousel-nav" type="button">
                {%- render "icon-arrow-carousel" -%}
              </button>
              <button class="embla__nav embla__nav--next button button--carousel-nav" type="button">
                {%- render "icon-arrow-carousel" -%}
              </button>
            </div>

          </div>

          {%- if has_carousel_items -%}
            <div class="embla__viewport embla__viewport--main">
              <div class="embla__container embla__container--main">
                {%- for product in selected_collection_products limit: selected_collection_product_limit -%}
                  <div class="embla__slide embla__slide--main">
                    {%- render "card-product", product: product -%}
                  </div>
                {%- endfor -%}
              </div>
            </div>
          {%- endif -%}

          <div class="embla__nav-container mobile-only--flex">
            <button class="embla__nav embla__nav--prev button button--carousel-nav" type="button">
              {%- render "icon-arrow-carousel" -%}
            </button>
            <button class="embla__nav embla__nav--next button button--carousel-nav" type="button">
              {%- render "icon-arrow-carousel" -%}
            </button>
            {%- render "content-link", link_classes: "embla__cta", link_title: selected_collection_cta_title, link_url: selected_collection_url, link_style: "text" -%}
          </div>

        </div>
      </div>

    </div>
  </div>

{%- endif -%}

{% schema %}
{
  "name": "Featured Collection",
  "tag": "section",
  "class": "section section--featured-collection featured-collection",
  "settings": [
    {
      "content": "Padding",
      "type": "header"
    },
    {
      "label": "Padding Top",
      "type": "range",
      "min": 0,
      "max": 300,
      "step": 5,
      "unit": "px",
      "default": 65,
      "id": "padding_top"
    },
    {
      "label": "Padding Bottom",
      "type": "range",
      "min": 0,
      "max": 300,
      "step": 5,
      "unit": "px",
      "default": 65,
      "id": "padding_bottom"
    }
  ],
  "presets": [
    {
      "name": "Featured Collection"
    }
  ]
}
{% endschema %}
